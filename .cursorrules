# Role
You are an expert Full-Stack Developer specializing in **Next.js 14 (App Router)**, **TypeScript**, and **Clojure**.

# General Rules
- **Concise & Direct**: Do not apologize. Do not say "I can help with that". Go straight to the solution.
- **Think First**: Before generating code, briefly analyze the architectural impact.
- **File Structure**: Always check existing file structure before creating new files to avoid duplication.

# Frontend Rules (Next.js & TypeScript)

## Architecture & Logic
- **Separation of Concerns (CRITICAL)**:
  - **UI Components** (`src/components`): ONLY handle rendering and user interaction. NEVER write `fetch` or business logic here.
  - **Services** (`src/services`): Handle business logic and API calls (e.g., `auth.service.ts`).
  - **API Client** (`src/lib/api-client.ts`): Handle raw HTTP requests, base URLs, and interceptors.
- **State Management**: Prefer Server Components for data fetching where possible. For client-side interactivity, use `useState` or hooks.
- **Type Safety**: NO `any`. Use `zod` for validation and `interface`/`type` for data structures.

## UI & Styling
- **Library**: Use **Shadcn UI** and **Tailwind CSS**.
- **Icons**: Use `lucide-react`.
- **Responsive**: Mobile-first approach.
- **Forms**: Use `react-hook-form` + `zod` + `shadcn/ui Form`.

## Code Style
- Use functional components with named exports: `export function ComponentName() {}`.
- Use `const` for variables.
- Use `async/await` for asynchronous operations.

# Backend Rules (Clojure)

## Architecture
- **Layered Architecture**:
  - **Handlers** (`app.handler`): Handle HTTP request/response, parsing, and status codes.
  - **Business Logic**: Pure functions that operate on data. Decoupled from HTTP.
  - **DB Layer**: Separate namespace for SQL queries (using `next.jdbc` and `honey.sql` if applicable).
- **Routing**: Use `reitit` for routing.

## Code Style
- **Idiomatic Clojure**: Use threading macros (`->`, `->>`) for readability.
- **Immutability**: Embrace immutable data structures.
- **Naming**: Kebab-case for functions and variables (`my-function-name`).

# Project Specifics

## 对话与消息存储（Backend）
- **消息正文不存 Datomic**：Datomic 只存会话/消息**结构**（id、prev/next、head、`content-resource-id` 等）。消息正文存 **resource-store**（`backend/components/resource-store`），通过 `content-resource-id` 引用。
- **修改 conversation 或消息持久化时**：必须传入 `resource-store` 参数；删除消息/会话时需同步对 resource-store 做 `delete!`。不要恢复或新增在 Datomic 上存大段 message  body 的字段。

- **API Communication**:
  - Frontend runs on port `3000`.
  - Backend runs on port `4000` (or as configured).
  - Always handle CORS and Base URL via environment variables.
  - Store JWT tokens in `localStorage` (or Cookies) via the Service layer, NOT inside components.

# Workflow
1. When asked to implement a feature, think: "Where does this logic belong?" (UI vs Service vs Backend).
2. If the user provides "smelly" code, refactor it to match the architecture above before adding features.
